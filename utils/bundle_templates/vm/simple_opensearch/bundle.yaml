series: jammy

saas:
  grafana-dashboards:
    url: admin/cos.grafana-dashboards
  logging:
    url: admin/cos.loki-logging
  prometheus-scrape:
    url: admin/cos.prometheus-scrape
  prometheus-receive-remote-write:
    url: admin/cos.prometheus-receive-remote-write

applications:
  opensearch:
    charm: ${params.opensearch-charm}
    %{ if params.opensearch-channel-entry != "" }
    channel: ${params.opensearch-channel-entry}
    %{ endif }
    constraints: instance-type=c6a.2xlarge root-disk=100G spaces=internal-space
    num_units: 3
#    num_units: 1
    bindings:
      "": internal-space
    storage:
      opensearch-data: 400G

  tls-certificates-operator:
    charm: tls-certificates-operator
    constraints: instance-type=t2.medium root-disk=100G spaces=internal-space
    num_units: 1
    bindings:
      "": internal-space
    options:
      generate-self-signed-certificates: true
      ca-common-name: "CN_CA"

  grafana-agent:
    charm: grafana-agent
    channel: latest/stable
    bindings:
      "": internal-space

  sysconfig:
    charm: sysconfig
    channel: latest/stable
    bindings:
      "": internal-space
    options:
      sysctl: "{ vm.max_map_count: 262144, vm.swappiness: 0, net.ipv4.tcp_retries2: 5 }"

relations:
- - opensearch
  - tls-certificates-operator
- - opensearch
  - sysconfig
#- - grafana-agent
#  - opensearch
- - grafana-agent
  - grafana-dashboards
- - grafana-agent
  - prometheus-receive-remote-write
- - grafana-agent
  - logging
